<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/mystyle.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  
</head>
<body>

<!--Navigation Bar. All links are broken currently. Check if links like OSCAR, etc. should be added.-->
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <a class="navbar-brand" href="#">
    <img src="/static/bee.png" alt="logo" style="width:40px;">
  </a>
  
  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" href="#">Home</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Some Other Link</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Yet Another Link</a>
    </li>
  </ul>
</nav>

<!--Adding a jumbotro bar on top. No functionality, just for aesthetics.-->
<div class="jumbotron text-center bg-info text-white" style="margin-bottom:0">
  <h1>Suggested Courses For You</h1>
</div>

<!--Creates some space between the jumbotron and the filters div.-->
<div class="container m-5"></div>

<!--Adding functionality to have negative filters and preferences as well.-->
<script>
  function ts(cb) {
    if (cb.readOnly) cb.checked=cb.readOnly=false;
    else if (!cb.checked) cb.readOnly=cb.indeterminate=true;
  }
</script>

<div class="container">
  <button type="button" class="btn btn-danger btn-lg m-2" id="populate_button">Populate</button>
</div>

<!--Start of the filters container.-->
<div class="container" id="filters_container">
  <div class="row"><h2>FILTERS</h2></div>
  <div class="row">
    <!--Headers for the set of filters provided by us.-->
    <div class="col" style="background-color:lavender;"></div>
    <div class="col" style="background-color:lavender;"><h4>NAME<h4></div>
    <div class="col" style="background-color:lavender;"><h4>PROFESSOR</h4></div>
    <div class="col" style="background-color:lavender;"><h4>FIELD</h4></div>
    <div class="col" style="background-color:lavender;"><h4>LOCATION</h4></div>
    <div class="col" style="background-color:lavender;"><h4>DAYS</h4></div>
  </div>

  <!--A single row depicting all the filters set for this particular course.-->
  <!--This row is replicated to add filters for other courses using the "Add Course" button.-->
  <div class="row" id="filters_row">
    <div class="col" style="background-color:lavender;"><h4 id="course_1">COURSE</h4></div>
    <div class="col" style="background-color:lavender;">
      <!--Course based filter. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Course</button>
        <div class="dropdown-menu scrollable-menu" id = "course_names">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Professor based filter. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Professor</button>
        <div class="dropdown-menu scrollable-menu" id = "instructor_names">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Specialization based filter. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Specialization</button>
        <div class="dropdown-menu scrollable-menu" id = "field_names">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Location based filter. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Location</button>
        <div class="dropdown-menu scrollable-menu" id = "location_names">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Day of Week based filter. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Day of Week</button>
        <div class="dropdown-menu scrollable-menu" id = "day_names">
        </div>
      </div>
    </div>
  </div>
</div>

<!--This button helps add more rows to the filters matrix. Calls the fucntion defined below.-->
<div class="container">
  <button type="button" class="btn btn-secondary btn-lg m-2" id="filters_add_course">Add Course</button>
</div>

<script>
  $("#filters_add_course").click(function() {
    var filters_row = document.getElementById("filters_row");
    var clone = filters_row.cloneNode(true);
    document.getElementById("filters_container").appendChild(clone);
  });
</script>

<!--This container just adds gap between the Filter and Preferences Fields-->
<div class="container m-5"></div>

<!--This is the container for our Preferences Matrix.-->
<div class="container" id="prefs_container">
  <!--A single row depicting all the preferences set for this particular course.-->
  <!--This row is replicated to add preferences for other courses using the "Add Course" button.-->
  <div class="row"><h2>PREFERENCES</h2></div>
  <div class="row">
    <!--Similar to our filters, these are the set of preferences that the user can set.-->
    <div class="col" style="background-color:lavender;"></div>
    <div class="col" style="background-color:lavender;"><h4>NAME<h4></div>
    <div class="col" style="background-color:lavender;"><h4>PROFESSOR</h4></div>
    <div class="col" style="background-color:lavender;"><h4>FIELD</h4></div>
    <div class="col" style="background-color:lavender;"><h4>LOCATION</h4></div>
    <div class="col" style="background-color:lavender;"><h4>DAYS</h4></div>
  </div>

  <div class="row" id="prefs_row">
    <div class="col" style="background-color:lavender;"><h4>COURSE</h4></div>
    <div class="col" style="background-color:lavender;">
      <!--Course based preference. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Course</button>
        <div class="dropdown-menu">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Professor based preference. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Professor</button>
        <div class="dropdown-menu">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Specialization based preference. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Specialization</button>
        <div class="dropdown-menu">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Location based preference. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Location</button>
        <div class="dropdown-menu">
        </div>
      </div>
    </div>
    <div class="col" style="background-color:lavender;">
      <!--Day of Week based preference. Users are either want, not want, or not care about courses using a tri-state checkbox.-->
      <div class="btn-group">
        <button type="button" class="btn btn-primary" data-toggle="dropdown">Day of Week</button>
        <div class="dropdown-menu">
        </div>
      </div>
    </div>
  </div>
</div>

<!--This button helps add more rows to the preferences matrix. Calls the function defined below.-->
<div class="container">
  <button type="button" class="btn btn-secondary btn-lg m-2" id="pref_add_course">Add Course</button>
</div>

<script>
  $("#pref_add_course").click(function() {
    var prefs_row = document.getElementById("prefs_row");
    var clone = prefs_row.cloneNode(true);
    document.getElementById("prefs_container").appendChild(clone);
  });
</script>

<!--This is the filter button that users click on once they have set up their filters and preferences.-->
<!--Once clicked, search results are generated and displayed for the user.-->
<div class="container">
  <button type="button" class="btn btn-success btn-lg m-5 btn-block">Filter</button>
</div>

<!--Styling for our force directed graph generated.-->
<style>
  .links line {
    stroke: #999;
    stroke-opacity: 0.6;
  }
  
  .nodes circle {
    stroke: #fff;
    stroke-width: 1.5px;
  }
</style>

<!--Setting up the SVG within which our graph will be rendered.-->
<svg width="1920" height="1080"></svg>

<!--Importing D3 libraries and setting up the Force Directed Graph.-->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
  var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

  // Sets the size of the nodes of our graph.
  var radius = 30;

  // This sets a "group number" based coloring scheme for our nodes.
  var color = d3.scaleOrdinal(d3.schemeCategory20);

  // force("link")  : Determines the length of the link between nodes. Since we're currently pinning nodes to particular coordinated, this is redundant.
  // force("charge"): Determines the force between individual nodes. Helps prevent nodes from overlapping. Redundant due to above reason.
  // force("center"): Determines a particular corrdinate towards which all nodes are attracted. This is to prevent nodes from flying off the SVG viewbox.
  var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }).distance(250));
 //   .force("charge", d3.forceManyBody().strength(-50))
 //   .force("center", d3.forceCenter(width / 2, height / 2));

  // Mock data for visualization. Must be replaced with a call to the backed to retrieve actual search results.
  var data = {
  "nodes": [
    {"id": "1 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "1 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "1 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "1 High Performance Parallel Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "2 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "2 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "2 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "2 High Performance Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "3 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "3 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "3 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "3 High Performance Parallel Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "4 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "4 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "4 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "4 High Performance Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "5 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "5 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "5 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "5 High Performance Parallel Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "6 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "6 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "6 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "6 High Performance Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "7 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "7 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "7 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "7 High Performance Parallel Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "8 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "8 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "8 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "8 High Performance Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "9 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "9 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "9 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "9 High Performance Parallel Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
    {"id": "0 Adv Operating Systems", "professor": "Umakishore", "field": "Computing Systems", "location": "Space Center", "days": ["M", "W", "F"]},
    {"id": "0 Machine Learning", "professor": "Abhigyaan Khaund", "field": "Machine Learning", "location": "Inspire", "days": ["M", "W"]},
    {"id": "0 Computer Networks", "professor": "Mustafa Ammar", "field": "Computing Systems", "location": "Instruction Center", "days": ["T", "Th"]},
    {"id": "0 High Performance Computing", "professor": "Tobin Isaacs", "field": "High Performance Parallel Computing", "location": "Fernst", "days": ["M", "W"]},
  ],
  "links": [
    {"source": "1 Adv Operating Systems", "target": "1 Machine Learning", "value": 10},
    {"source": "1 Machine Learning", "target": "1 Computer Networks", "value": 10},
    {"source": "1 Computer Networks", "target": "1 High Performance Parallel Computing", "value": 10},
    {"source": "2 Adv Operating Systems", "target": "2 Machine Learning", "value": 10},
    {"source": "2 Machine Learning", "target": "2 Computer Networks", "value": 10},
    {"source": "2 Computer Networks", "target": "2 High Performance Computing", "value": 10},
    {"source": "3 Adv Operating Systems", "target": "3 Machine Learning", "value": 10},
    {"source": "3 Machine Learning", "target": "3 Computer Networks", "value": 10},
    {"source": "3 Computer Networks", "target": "3 High Performance Parallel Computing", "value": 10},
    {"source": "4 Adv Operating Systems", "target": "4 Machine Learning", "value": 10},
    {"source": "4 Machine Learning", "target": "4 Computer Networks", "value": 10},
    {"source": "4 Computer Networks", "target": "4 High Performance Computing", "value": 10},
    {"source": "5 Adv Operating Systems", "target": "5 Machine Learning", "value": 10},
    {"source": "5 Machine Learning", "target": "5 Computer Networks", "value": 10},
    {"source": "5 Computer Networks", "target": "5 High Performance Parallel Computing", "value": 10},
    {"source": "6 Adv Operating Systems", "target": "6 Machine Learning", "value": 10},
    {"source": "6 Machine Learning", "target": "6 Computer Networks", "value": 10},
    {"source": "6 Computer Networks", "target": "6 High Performance Computing", "value": 10},
    {"source": "7 Adv Operating Systems", "target": "7 Machine Learning", "value": 10},
    {"source": "7 Machine Learning", "target": "7 Computer Networks", "value": 10},
    {"source": "7 Computer Networks", "target": "7 High Performance Parallel Computing", "value": 10},
    {"source": "8 Adv Operating Systems", "target": "8 Machine Learning", "value": 10},
    {"source": "8 Machine Learning", "target": "8 Computer Networks", "value": 10},
    {"source": "8 Computer Networks", "target": "8 High Performance Computing", "value": 10},
    {"source": "9 Adv Operating Systems", "target": "9 Machine Learning", "value": 10},
    {"source": "9 Machine Learning", "target": "9 Computer Networks", "value": 10},
    {"source": "9 Computer Networks", "target": "9 High Performance Parallel Computing", "value": 10},
    {"source": "0 Adv Operating Systems", "target": "0 Machine Learning", "value": 10},
    {"source": "0 Machine Learning", "target": "0 Computer Networks", "value": 10},
    {"source": "0 Computer Networks", "target": "0 High Performance Computing", "value": 10},
  ]
}

  // Adding links to group "g".
  var link = svg.append("g")
      .attr("class", "links")
      .selectAll("line")
      .data(data.links)
      .enter().append("line")
        .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

  // Adding nodes to the group "g".
  var node = svg.append("g")
    .attr("class", "nodes")
    .selectAll("circle")
    .data(data.nodes)
    .enter().append("circle")
      .attr("r", radius)
      .attr("fill", function(d) { return color(d.group); })
      .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

  node.append("title")
    .text(function(d) { return d.id; });

  // Adding course names to the nodes.
  var texts = svg.selectAll("text.label")
            .data(data.nodes)
            .enter().append("text")
            .attr("class", "label")
            .attr("fill", "black")
            .text(function(d) {  return d.id;  });

  // Initializing the simulation nodes and links.
  simulation
      .nodes(data.nodes)
      .on("tick", ticked);

  simulation.force("link")
      .links(data.links);

  function ticked() {
    // This is the original code where the nodes are not arranged and keep moving around. Leaving it here for future reference.
    // link
    //     .attr("x1", function(d) { return d.source.x; })
    //     .attr("y1", function(d) { return d.source.y; })
    //     .attr("x2", function(d) { return d.target.x; })
    //     .attr("y2", function(d) { return d.target.y; });

    // node
    //     .attr("cx", function(d) { return d.x = Math.max(radius, Math.min(width - radius, d.x));})
    //     .attr("cy", function(d) { return d.y = Math.max(radius, Math.min(height - radius, d.y)); });

    // Pinning the nodes down to their respective locations based on their order in the backend returned search results.
    node
        .attr("cx", function(d) { return d.x = ((d.index % 4) * width / 5) + 5 * radius;})
        .attr("cy", function(d) { return d.y = ((d.index / 4) * (height - 4 * radius) / 10) + 2 * radius; });
    
    // Moving course names to the updated location of their corresponding nodes.
    texts.attr("transform", function(d) {
      return "translate(" + d.x + "," + d.y + ")";
    });

    // Updating the link end points to the updated node locations.
    link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });
  }

  // The following function are redundant, since the nodes are pinned down.
  function dragstarted(d) {
    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
  }

  function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
  }

  function dragended(d) {
    if (!d3.event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
  }

  // Add on click event for populate_button
  $("#populate_button").click(function() {
    // Make a get to populate endpoint to fetch results in data variable
    $.get("/populate", function(data) {
        // Get a list of courses from data.courses
        var courses = data.courses;
        console.log(data)
        // Insert an a tag for each course in courses into all divs with id course_names
        $("#course_names").empty();
        for (var i = 0; i < courses.length; i++) {
            $("#course_names").append("<a class='dropdown-item' href='#'><input type='checkbox' onClick='ts(this)'/>&nbsp;" + courses[i] + "</a>");
        }

        // Get a list of instructors from data.instructors
        var instructors = data.instructors;
        // Insert an a tag for each instructor in instructors into all divs with id instructor_names
        $("#instructor_names").empty();
        for (var i = 0; i < instructors.length; i++) {
            $("#instructor_names").append("<a class='dropdown-item' href='#'><input type='checkbox' onClick='ts(this)'/>&nbsp;" + instructors[i] + "</a>");
        }
        
        // Get a list of fields from data.fields
        var fields = data.fields;
        // Insert an a tag for each field in fields into all divs with id field_names
        $("#field_names").empty();
        for (var i = 0; i < fields.length; i++) {
            $("#field_names").append("<a class='dropdown-item' href='#'><input type='checkbox' onClick='ts(this)'/>&nbsp;" + fields[i] + "</a>");
        }

        // Get a list of locations from data.locations
        var locations = data.locations;
        // Insert an a tag for each location in locations into all divs with id location_names
        $("#location_names").empty();
        for (var i = 0; i < locations.length; i++) {
            $("#location_names").append("<a class='dropdown-item' href='#'><input type='checkbox' onClick='ts(this)'/>&nbsp;" + locations[i] + "</a>");
        }

        // Get a list of Days from data.days
        var days = data.days;
        // Insert an a tag for each day in days into all divs with id day_names
        $("#day_names").empty();
        for (var i = 0; i < days.length; i++) {
            $("#day_names").append("<a class='dropdown-item' href='#'><input type='checkbox' onClick='ts(this)'/>&nbsp;" + days[i] + "</a>");
        }
    });
  });
</script>

<!--Helps retrive the next and previous batch of results.-->
<div class="container">
  <ul class="pagination justify-content-end">
    <li class="page-item"><a class="page-link" href="#">Previous</a></li>
    <li class="page-item"><a class="page-link" href="#">Next</a></li>
  </ul>
</div>

</body>
</html>
